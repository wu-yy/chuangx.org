<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="ThemeBucket">
  <link rel="shortcut icon" href="#" type="image/png">

  <title>消息列表</title>
	<script src="__PUBLIC__/js/index/jquery1.9.1.js" type="text/javascript"></script>
  <!--data table-->
  <link rel="stylesheet" href="__PUBLIC__/incourse/js/data-tables/DT_bootstrap.css" />

  <link href="__PUBLIC__/Admin/css/style.css" rel="stylesheet">
  <link href="__PUBLIC__/Admin/css/style-responsive.css" rel="stylesheet">
  <style>
     .icon-edit{font-size:18px; margin-right:10px;}
	 .icon-wid{ width:15%;}
	 /* Search */
#Search{margin:20px auto; margin-bottom:20px;}
.text{margin-bottom:20px;}
#Search input{margin-bottom:20px;float:left;width:140px;background-color:#F7F8F9;border:1px solid;border-color:#c2c0c0 #cccaca #d1cfcf;font-size:14px;line-height:1.8;
	
	border-radius:3px 0 0 3px;
	-moz-border-radius:3px 0 0 3px;
	-webkit-border-radius:3px 0 0 3px;
	
	box-shadow:0 1px #fff, inset 0 1px rgba(34,25,25,0.05);
	-moz-box-shadow:0 1px #fff, inset 0 1px rgba(34,25,25,0.05);
	-webkit-box-shadow:0 1px #fff, inset 0 1px rgba(34,25,25,0.05);
}
#Search input:focus{
	background-color:#fff;
	box-shadow:0 1px #fff, inset 0 1px rgba(34,25,25,0.1);
	-moz-box-shadow:0 1px #fff, inset 0 1px rgba(34,25,25,0.1);
	-webkit-box-shadow:0 1px #fff, inset 0 1px rgba(34,25,25,0.1);
}
#Search a{
	float:left;margin-left:-1px;padding:6px 7px 1px 7px;min-height:17px;_height:17px;border:1px solid;border-color:#c2c0c0 #cccaca #d1cfcf;
	
	border-radius:0 3px 3px 0;
	-moz-border-radius:0 3px 3px 0;
	-webkit-border-radius:0 3px 3px 0;
	
	box-shadow:0 1px rgba(255,255,255,0.9), inset 0 0 2px rgba(255,255,255,0.75);
	-moz-box-shadow:0 1px rgba(255,255,255,0.9), inset 0 0 2px rgba(255,255,255,0.75);
	-webkit-box-shadow:0 1px rgba(255,255,255,0.9), inset 0 0 2px rgba(255,255,255,0.75);
}
#Search a:active{
	box-shadow:inset 0 1px 1px rgba(34,29,29,0.15);
	-moz-box-shadow:inset 0 1px 1px rgba(34,29,29,0.15);
	-webkit-box-shadow:inset 0 1px 1px rgba(34,29,29,0.15);
}
.box {
    width: 400px;
    height: 200px;
    padding-top: 30px;
    position: fixed;
    top: 50%;
    left: 58%;
    background: white;
    margin-left: -300px;
    margin-top: -150px;
    border-radius: 6px;
    border: 1px solid #999;
    text-align: center;
}
.box p{}
.box .box-bottom{width:100%;height:50px; position:absolute;left:0;bottom:0;}
  </style>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>

<body class="sticky-header" style="background: #EFF0F4 none repeat scroll 0% 0%;">

    <!-- left side start-->
   
    <!-- left side end-->
    


        <!-- header section start-->
        
        <!-- header section end-->

        <!-- page heading start-->
        <div class="page-heading">
            <h3>
                课程列表
            </h3>
            <ul class="breadcrumb">
                <li>
                    <a href="__URL__/index/">消息中心</a>
                </li>
                <li class="active">课程消息列表</li>
            </ul>
        </div>
        <!-- page heading end-->

        <!--body wrapper start-->
        <div class="wrapper">
           <div class="row">
                <div class="col-sm-12">
                <section class="panel">
                <header class="panel-heading">
                    消息列表
                    
                </header>
                <div class="panel-body">
                <div class="adv-table editable-table ">
                <div class="clearfix">
                	<a href="__URL__/course_mood">
                    <div class="btn-group">
                        <button id="editable-sample_new" class="btn btn-primary">
                            添加微信模板 <i class="fa fa-plus"></i>
                        </button>
                    </div>
                    </a>
                    <a href="__URL__/course_me_mood">
                    <div class="btn-group">
                        <button id="editable-sample_new" class="btn btn-primary">
                            添加短信模板 <i class="fa fa-plus"></i>
                        </button>
                    </div>
                    </a>
                    
                </div>
                    
               
                
                <table class="table table-striped table-hover table-bordered" style=" margin-top:20px;" id="editable-sample">
                <thead>
                <tr>
                	<th>消息id</th>
                    <th>标题</th>
                    <th>录入时间</th>
                    <th>发送信息类型</th>
                    <th>是否已发送信息</th>
                    <th>模板信息状态</th>
                    <th>关注课程总人数</th>
					<th>发送成功人数</th>
                    <th>操作</th>
                 
                </tr>
                </thead>
                <tbody>
                <volist name="list" id="vo">
                <tr class="">
                	<th>{$vo.id}</th>
                    <td>{$vo.title}</td>
                    <td>{$vo.time|date="y年m月d日",###}</td>
                    <td class="center"><if condition="$vo.send_type eq 1 "> 微信 </if><if condition="$vo.send_type eq 0 "> 手机短信 </if></td>
                    <td><if condition="$vo.is_send eq 0 ">未发送</if><if condition="$vo.is_send eq 1 ">已发送</if></td>
                    <td class="center" id="shanchu{$vo.id}"><if condition="$vo.is_delect neq 1 "> 未删除 </if><if condition="$vo.is_delect eq 1 "> 已删除 </if></td>
					<td>{$vo.course_user_nu}</td>
                    <td>{$vo.nspnu}</td>
                    <td class="icon-wid">
                    	 <if condition="$vo.is_delect neq 1 ">
                         <if condition="$vo.is_send eq 0 ">
                    	 <a class="icon-edit" onClick="fasong({$vo.id},'{$vo.title}');">发送</a>
                         </if>
                         </if>
                       <!--<a  >&nbsp;&nbsp;&nbsp;<i class="fa fa-edit"></i></a>-->
                       <a class="icon-edit" href="__URL__/xiugai/id/{$vo.id}"><i class="fa fa-edit"></i></a>
                       <div id="sh{$vo.id}" style="float:right; margin-right:10px;">
                       <if condition="$vo.is_delect neq 1 ">
                       <a class="icon-edit" href="javascript:;" onClick="del({$vo.id});"><i class="fa fa-times-circle"></i></a>
                       </if>
                       <if condition="$vo.is_delect eq 1 ">
                       <a class="icon-edit" href="javascript:;" onClick="sav({$vo.id});"><i class="fa fa-undo"></i></a>
                       </if>
                       </div>
                    </td>
                    
                </tr>
                
                </volist>
                
                

                <tr>
                    <td colspan="5">{$page}</td>
                </tr>
                </tbody>
                </table>
                </div>
                </div>
                </section>
                </div>
                </div>
        </div>
        <!--body wrapper end-->
        <div class="box" id="box" style="display:none;">
        <p>
        <span>模板名称</span>
        <span id="title_name"></span>
        </p>
         <p id='shaohou' style="display:none;">
		 正在发送信息请稍后.....	
        </p>
        <p id='allp' style="display:none;">
        <span>总人数</span>
        <span id='allpe'></span>
        </p>
        <p id='sp' style="display:none;">
        <span>发送成功人数</span>
        <span id="supe"></span>
        </p>
        <div class="box-bottom">
        <button onClick="shuaxin()" id='tr' style="display:none;">确定</button>
        </div>
        </div>
        <!--footer section start-->


<!-- Placed js at the end of the document so the pages load faster -->
<script src="__PUBLIC__/incourse/js/jquery-1.10.2.min.js"></script>
<script src="__PUBLIC__/incourse/js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="__PUBLIC__/incourse/js/jquery-migrate-1.2.1.min.js"></script>
<script src="__PUBLIC__/incourse/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/incourse/js/modernizr.min.js"></script>
<script src="__PUBLIC__/incourse/js/jquery.nicescroll.js"></script>

<!--data table-->
<script type="text/javascript" src="__PUBLIC__/incourse/js/data-tables/jquery.dataTables.js"></script>
<script type="text/javascript" src="__PUBLIC__/incourse/js/data-tables/DT_bootstrap.js"></script>

<!--common scripts for all pages-->
<!--<script src="__PUBLIC__/incourse/js/scripts.js"></script>-->

<!--script for editable table-->
<script src="__PUBLIC__/incourse/js/editable-table.js"></script>

<!-- END JAVASCRIPTS -->
<script>
    jQuery(document).ready(function() {
       //EditableTable.init();
    });
</script>
<script>
    function fasong(id,name)
	{
		if(!id)
		{
			return;	
		}
		
		var obj = {};
		obj.key = "value";
		$.post("__URL__/checkmood/id/"+id, obj,
			function(data,status)
				{
					if(data==0)
					{
						alert('网络错误');return;	
					}
					if(data==2)
					{
						alert('模板信息已发送');return;	
					}
					if(data==3)
					{
						alert('模板信息已被删除');return;
					}
					if(data==1)
					{
						document.getElementById("box").style.display='block';
						document.getElementById("allp").style.display='none';
						document.getElementById("sp").style.display='none';
						document.getElementById("tr").style.display='none';
						document.getElementById("shaohou").style.display='block';
						document.getElementById("title_name").innerHTML=name;	
						
									var obj = {};
		obj.key = "value";
		$.post("__URL__/send_mood/id/"+id, obj,
			function(data,status)
				{
					var arr=eval(data);
					if(arr[0]==0)
					{
						document.getElementById("box").style.display='none';
						alert('发送信息失败，未知错误');
					}
					
					if(arr[0]==1)
					{
						var a=arr[1];
									
						var b=arr[2];
						
						document.getElementById("box").style.display='block';
						
						document.getElementById("allpe").innerHTML=a+'人';
						
						document.getElementById("supe").innerHTML=b+'人';
						
						document.getElementById("allp").style.display='block';
						
						document.getElementById("sp").style.display='block';
						
						document.getElementById("tr").style.display='block';
						
						document.getElementById("shaohou").style.display='none';
	
					}
				
				}
			   );
						
						
					}
				}
			   );  
			   

				
	} 
    function del(id)
	{
		if(confirm("是否确认删除课程？"))
		{
			var obj = {};
					obj.key = "value";
					$.post("__URL__/del/id/"+id, obj,
						function(data,status)
							{
								
								if(data==1)
								{
									document.getElementById("shanchu"+id).innerHTML = "已删除";
									
									document.getElementById("sh"+id).innerHTML = '<a class="icon-edit" href="javascript:;" onClick="sav('+id+');"><i class="fa fa-undo"></i></a>'
								}
								else
								{
									alert("删除失败，未知错误");	
								}
							}
						   );
						   
		}

	}
	function sav(id)
	{
		if(confirm("是否确认恢复课程？"))
		{
			var obj = {};
					obj.key = "value";
					$.post("__URL__/sav/id/"+id, obj,
						function(data,status)
							{
								
								if(data==1)
								{
									document.getElementById("shanchu"+id).innerHTML = "未删除";	
									
									document.getElementById("sh"+id).innerHTML ='<a class="icon-edit" href="javascript:;" onClick="del('+id+');"><i class="fa fa-times-circle"></i></a>'
								}
								else
								{
									alert("恢复失败，未知错误");	
								}
							}
						   );
						   
		}

	}
	function shuaxin()
	{
		window.location.href=window.location.href;	
	}
</script>

</body>
</html>
