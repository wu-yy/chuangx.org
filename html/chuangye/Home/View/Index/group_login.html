<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>无标题文档</title>
<link rel="shortcut icon" href="__PUBLIC__/image/16x16logo.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" media="screen" href="__PUBLIC__/css/style.css"/>
<link rel="stylesheet" type="text/css" media="screen" href="__PUBLIC__/css/infromation.css"/>
<link href="__PUBLIC__/css/focus.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="__PUBLIC__/css/common.css"/>
<link rel="stylesheet" href="__PUBLIC__/css/style20151231.css"/>
<link rel="stylesheet" href="__PUBLIC__/css/findpw.css"/>
<script src="__PUBLIC__/js/index/jquery1.9.1.js" type="text/javascript"></script>
<script src="__PUBLIC__/js/index/sea.js" type="text/javascript" data-main="focus.js"></script>
<script src="__PUBLIC__/js/index/index.js"></script>
<script src="__PUBLIC__/js/index/zhuce.js"></script>

<style type="text/css">
.sy_input{
	margin:0 auto;
	text-align:center;
	width:310px;
	height:62px;
	border:1px solid #c1c1c1;
	line-height:62px;
	margin-bottom:15px;
}
</style>
<script>
function log_url2(Jump_page,head)
{
	var url=window.location.href;
	var ur="{:U('Index/log')}";
		var obj = {};
		obj.key = "value";
		$.post(ur, {'head': head,'Jump_page':Jump_page,'url':url},
			function(data,status)
				{
				}
			   );			   
}
function log_url(e,Jump_page,head)
{
	var url=window.location.href;
	var ur="{:U('Index/log')}";
		var obj = {};
		obj.key = "value";
		$.post(ur, {'head': head,'Jump_page':Jump_page,'url':url},
			function(data,status)
				{
				}
			   );
	window.location.href=Jump_page; 			   
			   e.cancelBubble = true;
}

function log_url1(e,Jump_page,head)
{
	var url=window.location.href;
	var ur="{:U('Index/log')}";
		var obj = {};
		obj.key = "value";
		$.post(ur, {'head': head,'Jump_page':Jump_page,'url':url},
			function(data,status)
				{
				}
			   );			   
			   e.cancelBubble = true;
}
</script>

</head>

<body style=" background:#fff;">
	<div id="login1">
	<div class="login_content" style="background-image:none;left:25%;right:25%"><!--主页上点击登录之后的页面-->
      <div class="sy_lg_content">
      	<div style="font-size:10px;float:left;margin-let:30px">【{$groupname}】</div>
      	<div style="font-size:18px;float:left;margin-left:0px">群组登录</div>
        <a class="sy_zhuce" href="javascript:;" onclick="zcaaa(event);">没有账号，免费注册 </a>
				<div id="pwuser" style="width: 310px; height: 25px; line-height: 25px; border-radius: 5px; text-align: center; margin: 0 auto; color:#FF0000;">
		</div>
        <div class="sy_shuru">
            <ul>
                <li>
                    <div class="sy_name"><img src="__PUBLIC__/image/sjh.png"/></div>
                    <input class="sy_shuruk" id="login_name" type="text" placeholder="请输入邮箱或手机号码" />
                </li>
                <li>
                    <div class="sy_name"><img src="__PUBLIC__/image/mm.png"/></div>
                    <input class="sy_shuruk"  id="user_name" type="password" placeholder="请输入密码"/>
                </li>
                
            </ul>
            <a style="font-size:14px; color:#06F; float:right; padding-top:4px; padding-right:40px; padding-bottom:20px;" href="javascript:;" onClick="log_url(event,'{:U('Findpw/index')}','public_loginAndRegister')">忘记密码？</a> <!--log_url：post+跳转页面-->
            <input class="sy_lg_fd" type="submit"name="anniu"  value="登录" onclick="g_login(event);" /><!--该input直接显示“登录”，充当按钮-->
                                        <!---->
        </div>
      </div>
    </div>
    </div>
    <!--login1(登录) end  ;   login(注册) begin-->
    <div id="login" style=" display:none;">  
    <div class="login_zc_content" style="display:block; margin-top:-30px;background-image:none; left:25%; right:25%">
      <div class="sy_lg_content">
        <div style="font-size:10px;float:left;margin-let:10px">【{$groupname}】</div>
      	<div style="font-size:18px;float:left;margin-left:10px">群组注册</div>
        <a class="sy_zhuce" style=" margin-bottom:0px;" href="javascript:;" onclick="jump_login(event);">已有账号，直接登录 </a>
		<div id="username" style="width: 310px; height: 25px; line-height: 25px; border-radius: 5px; text-align: center; margin: 0 auto; color:#FF0000;">
			
		</div>
        <div class="sy_shuru" style="border:0px">
            <ul>
                <li>
                    <input class="sy_zc_shuruk" name="zcdl" id="index_user" type="text" placeholder="请输入邮箱或手机号码"/>
                </li>
                <li class="nostyle" style="border:0px; box-shadow:none; margin-left:0px">
                
                    <div class="sy_yzm_sr" style=" foalt:left !important;">
                        <input class="sy_shuruk_yzm" id="yzm"name="zcdl" type="text" placeholder="请输入验证码"/>
                     </div>
                        <a style=" width:97px; margin-left:5px; float:left;height: 52px !important;
line-height: 52px !important;" href="javascript:;" onclick="huoqu(event);">
						<div id="send" style="display:inline; float:left; height:58px">获取验证码</div></a>
                 
                </li>
                
                <li>
                    <input class="sy_zc_shuruk" id="pw"name="zcdl" type="password" placeholder="请输入密码"/>
                </li>
				
                
            </ul>
            <input class="sy_lg_zc" type="submit" name="anniu" value="注册" onclick="user(event);"/>
        </div>
        
      </div>
    </div>
<!--    <div class="mask" id="dialogBg"></div>-->
</div>

</body>
</html>
<script>
//点击登录
//login()+group login
function g_login(e)
{
	if(!login(e)){//not login successfully
		console.log('login failure');
		return;
	}
	//console.log(window.location.href);
	//var obj = {}
	//obj.key = 'value';
	var ul = "{:U('Index/g_login')}";
	//var gid = 3;//加入的群组id，该id应该从最初的url中得到，现在只是测试
	console.log(ul+"?code="+'11425');
	//$.post(ul, {'url': window.location.href},
	$.post(ul, {},
			function(data,status)
            {
					console.log("backfunction");
					if(data == 0){
						console.log('没有账号');
						document.getElementById("pwuser").innerHTML = "没有账号";
						//setTimeout("window.location.reload()",2000);
						return;
					}
					console.log('begin eval');
					var arr=eval(data);
					if(arr[0]==1)
					{
						document.getElementById("pwuser").innerHTML=arr[2];
						//setTimeout("window.location.href = '{:U('Uinfo/index')}';",2000);

                        //修改 wuyongyu 跳转到主界面
                        var t1 = "{:U('Index/group')}";
                        var t2=arr[1];
                        console.log(t1+"?gid="+t2);
                        var t3=t1+"?gid="+t2;
                        window.location.href =t3;
						console.log('添加成功');//incoude "你已加入该群组"
						
					}
					else
					{
					    // 修改 wuyongyu
						document.getElementById("pwuser").innerHTML=arr[2];
                        //setTimeout("window.location.href = '{:U('Index/group',array('gid'=>2))}';",2000);//修改 wuyongyu 跳转到主界面
                        var t1 = "{:U('Index/group')}";
                        var t2=arr[1];
                        console.log(t1+"?gid="+t2);
                        var t3=t1+"?gid="+t2;
                        window.location.href =t3;
                        console.log('添加不成功，已经在群组中');
					}
					//console.log(arr[1]);

				}
			);

}

function zcaaa(e)//注册界面跳转
	{
		e.cancelBubble = true;
		
		log_url1(e,'open_register','public_loginAndRegister');
		
		var div1=document.getElementById("login1");	
		
		div1.style.display="none";//关闭dialog
		
		var div = document.getElementById('login');
		
		div.style.display="block";//打开login界面
		}

function jump_login(e)
	{
		
		e.cancelBubble = true;
		
		log_url1(e,'open_login','public_loginAndRegister');
		
		var name=document.getElementById('index_user').value;
		
		var div1 = document.getElementById('login');
		
		div1.style.display="none";
		
				
		document.getElementById('login_name').value=name;
		
		var dialog = document.getElementById('login1');

		dialog.style.display="block";
		
	}
function checkNamezhuce(name,pw,isUser,url){
	
	document.getElementById("pwuser").innerHTML = "";	
	
	var ur="{:U('Index/checkname')}";
	
	var obj = {};
		obj.key = "value";
		$.post(ur+'?name='+name, obj,
			function(data,status)
				{
					if(data!=0)
					{
						return checkuser(url,name,pw,isUser);	
						
						//return;
					}
					else
					{
						document.getElementById("pwuser").innerHTML = "该用户未注册！！";
						return false;
					}
				}
			   );
}
function checkuser(url,name,pw,isUser)
{
	
	var ur="{:U('Index/checkuser')}";
	var a=window.xz;
	var obj = {};
		obj.key = "value";
		$.post(ur+"?name="+name+"&pw="+pw+"&isUser="+isUser+"&xuanzhong="+a, obj,
			function(data,status)
				{
					if(data==1)
						{
							document.getElementById("pwuser").innerHTML = "";//删除了“恭喜，登录成功”
							//window.location.reload();
							return true;
						}
						else 
						{
							document.getElementById("pwuser").innerHTML = "用户名或密码错误，请核对后重新登录";
							return false;
						}
				}
			   );

}

//检查数字验证码
function check_yzm()
{	

		var ur="{:U('Index/check_yzm')}";
		
		var yzm = document.getElementById("yzm").value;
		
		var pw = document.getElementById("pw").value;
		
		var name = document.getElementById("index_user").value;
	
		var obj = {};
		obj.key = "value";
		$.post(ur+"?rank="+yzm, obj,
			function(data,status)
				{
					if(data==1)
					{
						sub_mail(name,pw);
					}
					else
					{
						document.getElementById("username").innerHTML = "验证码错误！！";
						setTimeout("clearusername()", 2000);
					}	
				}
			   );

}
//提交注册信息，
function sub_mail(name,pw)
{
		document.getElementById("username").innerHTML = " ";
		
		var ur="{:U('Index/sub_user')}";
		
		var obj = {};
		obj.key = "value";
		$.post(ur+"?name="+name+"&pw="+pw+"&isUser="+isUser, obj,
			function(data,status)
				{
					if(data!=0)
						{
							document.getElementById("username").innerHTML = "恭喜，注册成功，正在跳转到登录页面";
							
							setTimeout("jump_login1()",2000);

							return;
						}
						else 
						{
							document.getElementById("username").innerHTML = "网路繁忙,注册失败,请稍候再试";
							return;
						}
						setTimeout("clearusername()", 2000);
				}
			   );
}
function checkName(name){
	
	document.getElementById("username").innerHTML = "";	
	
	var ur="{:U('Index/checkname')}";
	
	var obj = {};
		obj.key = "value";
		$.post(ur+"?name="+name, obj,
			function(data,status)
				{
					if(data!=0)
					{
						document.getElementById("username").innerHTML = "该用户已注册！！";
						setTimeout("clearusername()", 2000);
						return;
					}
					else
					{
						checkyzm(name);	//wenjing删除验证码验证
					}
				}
			   );
}
//检查图形验证码
function checkyzm(name)//check图形验证码,并发送后台检查验证码对错
{
	
		document.getElementById("username").innerHTML = "";
	
		//var pw=document.getElementById("picyzm").value;
		var pw = "no need";//注册不需要验证码
		if(!pw)
		{
			document.getElementById("username").innerHTML = "请填写验证码！！";	
			setTimeout("clearusername()", 2000);
			return;
		}
		var obj = {};
		var ur="{:U('Findpw/checkpw')}";
		obj.key = "value";
		$.post(ur+'?pw='+pw+'&name='+name, obj,   
			function(data,status)
				{
					if(data==1)
					{		
							
							sends();
							
							change_code();
							
							return;
					}
					else
					{
						document.getElementById("username").innerHTML = "请不要批量注册！！";	
						setTimeout("clearusername()",2000);
						return;
					}
				}
			   );
}

function change_code(){
	//	alert(125485);
	var verifyURL = '{:U("Findpw/verify", '','')}';
	$("#codes").attr("src",verifyURL+'/'+Math.random());
	log_url2('image_identifying_code','public_loginAndRegister');
	return false;
}

function checkNamezhuce(name,pw,isUser,url){
	
	document.getElementById("pwuser").innerHTML = "";	
	
	var ur="{:U('Index/checkname')}";
	
	var obj = {};
		obj.key = "value";
		$.post(ur+'?name='+name, obj,
			function(data,status)
				{
					if(data!=0)
					{
						checkuser(url,name,pw,isUser);	
						
						return;
					}
					else
					{
						document.getElementById("pwuser").innerHTML = "该用户未注册！！";
						setTimeout("document.getElementById('pwuser').innerHTML = ''", 2000);
						return;
					}
				}
			   );
}

function jump()
{
	var name = document.getElementById("index_user").value;
    
	 window.location.reload();
		
}	

function yzm(name)
{	

		var ur="{:U('Index/yzm')}";
		var obj = {};
		obj.key = "value";
		$.post(ur+"?name="+name, obj,
			function(data,status)
				{
					
						document.getElementById("username").innerHTML = data;
						
						var t=setTimeout("clearusername()",2000);
				}
			   );

}

function mail(name)
{	
		var ur="{:U('Index/mail')}";
		var obj = {};
		obj.key = "value";
		$.post(ur+"?mail="+name, obj,
			function(data,status)
				{
					if(data==1)
					{
						document.getElementById("username").innerHTML = "已发送验证码，注意查收";
					}
					else
					{
						document.getElementById("username").innerHTML = "发送失败，请使用手机注册";
					}	
						
						var t=setTimeout("clearusername()",2000);
				}
			   );

}

function jump_login1()
	{
		
		log_url2('open_login','public_loginAndRegister');
		
		var name=document.getElementById('index_user').value;
		
		var div1 = document.getElementById('login');
		
		div1.style.display="none";
		
				
		document.getElementById('login_name').value=name;
		
		var dialog = document.getElementById('login1');

		dialog.style.display="block";
		
	}
</script>